// App.js
import React from "react";
import { Text, View } from "react-native";
import { StatusBar } from "expo-status-bar";
import { NavigationContainer } from "@react-navigation/native";
import { createBottomTabNavigator } from "@react-navigation/bottom-tabs";
import { createNativeStackNavigator } from "@react-navigation/native-stack";
import { SafeAreaProvider } from "react-native-safe-area-context";
import { Ionicons } from "@expo/vector-icons";

import { GoalsProvider } from "./components/GoalsStore";
import { theme } from "./theme";

import WelcomeScreen from "./screens/WelcomeScreen";
import HomeScreen from "./screens/HomeScreen";
import GoalsScreen from "./screens/GoalsScreen";
import AddGoalScreen from "./screens/AddGoalScreen";
import GoalScreen from "./screens/GoalScreen";
import CalendarScreen from "./screens/CalendarScreen";

function Placeholder({ title }) {
  return (
    <View style={{ flex: 1, alignItems: "center", justifyContent: "center", backgroundColor: theme.bg }}>
      <Text style={{ fontWeight: "900", color: theme.muted }}>{title}</Text>
    </View>
  );
}

const Tab = createBottomTabNavigator();
const Stack = createNativeStackNavigator();
const RootStack = createNativeStackNavigator();

function GoalsStack() {
  return (
    <Stack.Navigator screenOptions={{ headerShown: false }}>
      <Stack.Screen name="GoalsHome" component={GoalsScreen} />
      <Stack.Screen name="Goal" component={GoalScreen} />
    </Stack.Navigator>
  );
}

function AddStack() {
  return (
    <Stack.Navigator screenOptions={{ headerShown: false }}>
      <Stack.Screen name="AddGoal" component={AddGoalScreen} />
    </Stack.Navigator>
  );
}

export default function App() {
  return (
    <SafeAreaProvider>
      <GoalsProvider>
        <NavigationContainer>
        <StatusBar style="dark" />

          <RootStack.Navigator screenOptions={{ headerShown: false }}>
    <RootStack.Screen name="Welcome" component={WelcomeScreen} />

    <RootStack.Screen name="Tabs">
  {() => (
    <Tab.Navigator
      screenOptions={({ route }) => ({
        headerShown: false,
        tabBarShowLabel: true,
        tabBarHideOnKeyboard: true,

        // Figma-like bar (shorter, padded, clean)
        tabBarStyle: {
          height: 64,
          paddingTop: 8,
          paddingBottom: 10,
          backgroundColor: theme.surface,
          borderTopWidth: 0,
          elevation: 10, // Android shadow
        },

        tabBarActiveTintColor: theme.text,
        tabBarInactiveTintColor: theme.muted,

        // Figma-like label
        tabBarLabelStyle: {
          fontSize: 10,
          fontWeight: "800",
          marginTop: 2,
        },

        // Icon mapping to match your Figma tabs
        tabBarIcon: ({ color, size, focused }) => {
          const map = {
            Rank: focused ? "trophy" : "trophy-outline",
            Goals: focused ? "leaf" : "leaf-outline",      // "Habits" in Figma
            Add: focused ? "add-circle" : "add-circle-outline",
            Calendar: focused ? "calendar" : "calendar-outline",
            Garden: focused ? "flower" : "flower-outline",
          };

          // Slightly larger icon like Figma
          const iconName = map[route.name] ?? "ellipse-outline";
          const iconSize = route.name === "Add" ? 28 : 22;

          return <Ionicons name={iconName} size={iconSize} color={color} />;
        },
      })}
    >
      <Tab.Screen name="Rank" children={() => <Placeholder title="Rank (Coming Soon)" />} />

      {/* This route is named "Goals" but your Figma label says "Habits" */}
      <Tab.Screen
        name="Goals"
        component={GoalsStack}
        options={{ tabBarLabel: "Habits" }}
      />

      <Tab.Screen
        name="Add"
        component={AddStack}
        options={{ tabBarLabel: "Add" }}
      />

      <Tab.Screen name="Calendar" children={() => <Placeholder title="Calendar (Coming Soon)" />} />
      <Tab.Screen name="Garden" children={() => <Placeholder title="Garden (Coming Soon)" />} />
    </Tab.Navigator>
  )}
</RootStack.Screen>
  </RootStack.Navigator>
        </NavigationContainer>
      </GoalsProvider>
    </SafeAreaProvider>
  );
}
